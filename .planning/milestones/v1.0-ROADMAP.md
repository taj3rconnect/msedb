# Milestone v1.0: MVP

**Status:** SHIPPED 2026-02-18
**Phases:** 1-8
**Total Plans:** 25

## Overview

MSEDB delivers a self-hosted email intelligence portal that connects to Microsoft 365 mailboxes, observes user behavior, detects repetitive patterns, and automates email actions with explicit user approval. The build follows a strict dependency chain: infrastructure and persistence must exist before authentication, authentication before Graph API access, observation before intelligence, intelligence before automation. Each phase produces a testable, working system. The Outlook Add-in ships last as a separate client consuming the established backend API.

## Phases

### Phase 1: Infrastructure Foundation

**Goal**: A running, healthy Docker Compose stack with all persistence layers, background job infrastructure, security hardening, and the Cloudflare Tunnel for webhook ingress -- ready for authentication and Graph API integration
**Depends on**: Nothing (first phase)
**Requirements**: INFR-01, INFR-02, INFR-03, INFR-04, INFR-05
**Plans**: 3 plans

- [x] 01-01-PLAN.md — Docker Compose stack, Dockerfiles, Express 5 backend skeleton, React 19 frontend shell
- [x] 01-02-PLAN.md — MongoDB/Redis connections, 9 Mongoose models with indexes, BullMQ queues and job schedulers
- [x] 01-03-PLAN.md — AES-256-GCM encryption, rate limiting, health endpoint, webhook handler, Cloudflare Tunnel

### Phase 2: Authentication & Token Management

**Goal**: Users can authenticate via Azure AD, maintain persistent sessions, connect multiple Microsoft 365 mailboxes, and have their tokens securely stored and proactively refreshed -- even across container restarts
**Depends on**: Phase 1
**Requirements**: AUTH-01, AUTH-02, AUTH-03, AUTH-04, AUTH-05, AUTH-06
**Plans**: 2 plans

- [x] 02-01-PLAN.md — MSAL OAuth flow, JWT sessions, auth middleware, ICachePlugin, token manager
- [x] 02-02-PLAN.md — Token refresh worker, admin user management, multi-mailbox connection flow

### Phase 3: Email Observation Pipeline

**Goal**: The system observes email activity in real-time via webhooks with delta query fallback, collecting deduplicated metadata events for every connected mailbox -- the data foundation for all intelligence and automation
**Depends on**: Phase 2
**Requirements**: OBSV-01, OBSV-02, OBSV-03, OBSV-04
**Plans**: 3 plans

- [x] 03-01-PLAN.md — Graph API client, webhook handler enhancement, subscription service, Cloudflare Tunnel
- [x] 03-02-PLAN.md — Metadata extractor, event collector, webhook-events BullMQ processor
- [x] 03-03-PLAN.md — Folder cache, delta sync service, delta-sync BullMQ processor

### Phase 4: Frontend Shell & Observation UI

**Goal**: Users can log in to the React dashboard, see real-time email activity stats, browse collected events, and verify the observation pipeline is working -- with the kill switch visible in persistent navigation from day one
**Depends on**: Phase 2, Phase 3
**Requirements**: DASH-01, DASH-02, PAGE-01
**Plans**: 3 plans

- [x] 04-01-PLAN.md — React + Vite + Tailwind + shadcn/ui setup, auth flow, protected routes
- [x] 04-02-PLAN.md — App shell layout, dashboard page, Socket.IO server+client, backend API endpoints
- [x] 04-03-PLAN.md — Email activity page with data table, filters, timeline chart, sender breakdown

### Phase 5: Pattern Intelligence

**Goal**: The system detects sender-level and folder routing patterns from accumulated email events, scores confidence with asymmetric risk thresholds, and presents actionable suggestions that users can approve, reject, or customize
**Depends on**: Phase 3, Phase 4
**Requirements**: PATN-01, PATN-02, PATN-03, PATN-04, PAGE-02
**Plans**: 3 plans

- [x] 05-01-PLAN.md — Pattern detection engine (sender-level, folder routing), confidence scorer (TDD)
- [x] 05-02-PLAN.md — BullMQ pattern-analysis processor, patterns REST API, dashboard stats integration
- [x] 05-03-PLAN.md — Patterns page UI with cards, confidence visualization, approve/reject/customize

### Phase 6: Automation & Safety

**Goal**: Approved patterns are converted into executable rules that the system evaluates against incoming email -- with a staging folder grace period, kill switch enforcement, whitelist protection, undo capability, and full audit logging ensuring no automated action is irreversible
**Depends on**: Phase 5
**Requirements**: AUTO-01, AUTO-02, AUTO-03, AUTO-04, SAFE-01, SAFE-02, SAFE-03, SAFE-04, SAFE-05, PAGE-03, PAGE-04, PAGE-05
**Plans**: 6 plans

- [x] 06-01-PLAN.md — Rule engine core, action executor, whitelist service, staging manager, StagedEmail TTL fix
- [x] 06-02-PLAN.md — Pattern-to-rule converter, undo service
- [x] 06-03-PLAN.md — Rules CRUD API, staging API, audit API, whitelist endpoints
- [x] 06-04-PLAN.md — Staging processor BullMQ job, rule engine webhook integration
- [x] 06-05-PLAN.md — Rules page with dnd-kit drag-and-drop reordering
- [x] 06-06-PLAN.md — Staging page with countdown timers, audit log page with undo

### Phase 7: Polish, Notifications & Admin

**Goal**: The remaining UI pages are complete -- settings for user preferences and mailbox management, admin panel for user and org-wide rule management, and an in-app notification system that keeps users informed without requiring them to check the dashboard
**Depends on**: Phase 6
**Requirements**: DASH-03, PAGE-06, PAGE-07
**Plans**: 3 plans

- [x] 07-01-PLAN.md — Backend APIs (notification service + CRUD, settings routes, admin analytics/health/org-rules), shadcn components
- [x] 07-02-PLAN.md — Notification bell/dropdown with Socket.IO push, Settings page with tabbed sections
- [x] 07-03-PLAN.md — Admin panel page with user management, org rules, analytics, system health, admin routing

### Phase 8: Outlook Add-in

**Goal**: Users can whitelist or blacklist senders and domains directly from within Outlook via taskpane and ribbon buttons, with actions syncing to the MSEDB backend and affecting automation rules in real time
**Depends on**: Phase 6, Phase 2
**Requirements**: PLUG-01, PLUG-02, PLUG-03, PLUG-04
**Plans**: 2 plans

- [x] 08-01-PLAN.md — Add-in scaffolding, manifest, webpack, NAA SSO auth, backend SSO middleware, CORS
- [x] 08-02-PLAN.md — Taskpane UI with sender/domain whitelist/blacklist actions, mailbox resolution, item change handler

---

## Milestone Summary

**Key Decisions:**

- Redis `noeviction` policy for BullMQ (not allkeys-lru)
- MSAL cache persisted to MongoDB via ICachePlugin for container restart survival
- Signed JWT as OAuth state parameter (no Redis nonce lookup)
- Webhook handler returns 202 immediately, all processing via BullMQ
- Vitest over Jest for ESM TypeScript compatibility
- Asymmetric confidence thresholds (98% delete, 85% move)
- Staging folder with 24h grace period + 7-day cleanupAt TTL
- Undo reverses actions in reverse order; 404 from Graph = partial success
- Org-wide whitelist in Redis Sets for O(1) lookup
- Field-level $set for preferences to prevent kill switch overwrite
- AdminGuard frontend-only; requireAdmin middleware is real security boundary
- NAA (Nested App Authentication) for Outlook Add-in SSO
- webpack.config.cjs for ESM package compatibility
- CORS origin callback for multi-origin support

**Issues Resolved:**

- Undo data gap: undoService messageId lookup fixed with targetId fallback
- React 19 compatibility: npm overrides for react-is with recharts
- Tailwind v4 in webpack: postcss-loader + @tailwindcss/postcss added

**Issues Deferred:**

- Cloudflare Tunnel not configured (webhook subscriptions will fail until operational)

**Technical Debt Incurred:**

- manifest.xml contains YOUR_AZURE_AD_CLIENT_ID placeholder (requires manual Azure AD config)
- INFR-02 (Cloudflare Tunnel) implementation deferred -- code is ready but tunnel not set up

---

_For current project status, see .planning/ROADMAP.md_
